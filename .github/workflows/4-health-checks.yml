name: Health Checks

on:
  workflow_call:
    secrets:
      BACKEND_URL:
        required: true
      VPS_HOST:
        required: true

jobs:
  health-checks:
    name: Verify Services Health
    runs-on: ubuntu-latest
    steps:
      - name: Wait for backend readiness
        uses: nev7n/wait_for_response@v1
        with:
          url: ${{ secrets.BACKEND_URL }}/api/game
          responseCode: 200
          timeout: 180000
          interval: 10000

      - name: Health Check Backend
        uses: wei/curl@v1
        with:
          args: -f ${{ secrets.BACKEND_URL }}/api/game

      - name: Wait for frontend readiness
        uses: nev7n/wait_for_response@v1
        with:
          url: http://${{ secrets.VPS_HOST }}/
          responseCode: 200
          timeout: 30000
          interval: 2000

      - name: Health Check Frontend
        uses: wei/curl@v1
        with:
          args: -f http://${{ secrets.VPS_HOST }}/

      - name: Log Health Checks Success
        run: |
          echo "SUCCESS: All health checks passed"
          echo "Timestamp: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
          echo "Backend: ${{ secrets.BACKEND_URL }}"
          echo "Frontend: http://${{ secrets.VPS_HOST }}/"
